CREATE OR ALTER PROCEDURE SEARCHARTICOLE1 (PARAM_ID INTEGER, PARAM_ARTICOL VARCHAR(255), PARAM_GRUPA INTEGER)
 RETURNS (ID INTEGER, NUME VARCHAR(100), PROD_TVA_VAL NUMERIC(8,2), BRUT NUMERIC(8,2), TVA_PROCENT NUMERIC(5,2), CALE_IMAGE VARCHAR(300), SHOW_IMAGE SMALLINT, TVA_ID INTEGER, COD_SGR VARCHAR(16), U_MASURA VARCHAR(10), ID_DEP NUMERIC(2), ID_TVA_AMEF NUMERIC(2))
AS DECLARE VARIABLE SEARCH_ARTICOL VARCHAR(255);
BEGIN
   -- Construim variabila pentru cautarea dupa nume
   IF (PARAM_ARTICOL IS NOT NULL AND PARAM_ARTICOL <> '') THEN
      SEARCH_ARTICOL = '%' || PARAM_ARTICOL || '%';
   ELSE
      SEARCH_ARTICOL = NULL;

   FOR SELECT 
          P.ID,
          P.NUME,
          P.PROD_TVA_VAL,
          P.BRUT,
          T.TVA_VAL AS TVA_PROCENT,
          P.CALE_IMAGE,
          P.SHOW_IMAGE,
          P.TVA_ID,
          P.COD_SGR,
          M.PRESCURTARE AS U_MASURA,
          P.DEPARTAMENT,
          T.CASA_GRUPA
       FROM SM_PRODUSE P
       INNER JOIN SM_TVA T ON P.TVA_ID = T.ID
       INNER JOIN SM_UNITATI_MASURA M ON P.UM = M.ID
       WHERE 
             (:PARAM_ID IS NULL OR P.ID = :PARAM_ID)
         AND (:SEARCH_ARTICOL IS NULL OR P.NUME LIKE :SEARCH_ARTICOL)
         AND (:PARAM_GRUPA IS NULL OR P.GRUPA_ID = :PARAM_GRUPA)
       ORDER BY P.ID DESC
       INTO :ID, :NUME, :PROD_TVA_VAL, :BRUT, :TVA_PROCENT, :CALE_IMAGE, :SHOW_IMAGE, 
            :TVA_ID, :COD_SGR, :U_MASURA, :ID_DEP, :ID_TVA_AMEF
   DO
   BEGIN
      SUSPEND;
   END
END