CREATE OR ALTER PROCEDURE CITESTEARTICOLE_GRUPA_GESTIUNE (MY_PARAM INTEGER, GESTIUNE_PARAM INTEGER)
 RETURNS (ID INTEGER, NUME VARCHAR(100), PROD_TVA_VAL NUMERIC(8,2), BRUT NUMERIC(8,2), TVA_PROCENT NUMERIC(5,2), CALE_IMAGE VARCHAR(500), SHOW_IMAGE NUMERIC(2), TVA_ID INTEGER, COD_SGR VARCHAR(16), U_MASURA VARCHAR(10), ID_DEP NUMERIC(2), ID_TVA_AMEF NUMERIC(2))
AS BEGIN
  IF (:MY_PARAM IS NOT NULL) THEN
  BEGIN
    IF (:GESTIUNE_PARAM IS NOT NULL AND :GESTIUNE_PARAM <> 0) THEN
    BEGIN
      -- Filtrare pe GRUPA_ID ?i GESTIUNE_ID c?nd GESTIUNE_PARAM nu este 0
      FOR SELECT
        P.ID, P.NUME, P.PROD_TVA_VAL, P.BRUT, T.TVA_VAL AS TVA_PROCENT, P.CALE_IMAGE, P.SHOW_IMAGE, P.TVA_ID, P.COD_SGR, M.PRESCURTARE AS U_MASURA
, P.DEPARTAMENT, T.CASA_GRUPA
      FROM SM_PRODUSE P
      INNER JOIN SM_TVA T ON P.TVA_ID = T.ID
      INNER JOIN SM_UNITATI_MASURA M ON P.UM = M.ID
      WHERE P.GRUPA_ID = :MY_PARAM AND P.GESTIUNE_ID = :GESTIUNE_PARAM
      ORDER BY P.NUME ASC
      INTO :ID, :NUME, :PROD_TVA_VAL, :BRUT, :TVA_PROCENT, :CALE_IMAGE, :SHOW_IMAGE, :TVA_ID, :COD_SGR, :U_MASURA
, :ID_DEP, :ID_TVA_AMEF
      DO
        SUSPEND;
    END
    ELSE
    BEGIN
      -- Filtrare doar pe GRUPA_ID c?nd GESTIUNE_PARAM este 0
      FOR SELECT
        P.ID, P.NUME, P.PROD_TVA_VAL, P.BRUT, T.TVA_VAL AS TVA_PROCENT, P.CALE_IMAGE, P.SHOW_IMAGE, P.TVA_ID, P.COD_SGR, M.PRESCURTARE AS U_MASURA
, P.DEPARTAMENT, T.CASA_GRUPA
      FROM SM_PRODUSE P
      INNER JOIN SM_TVA T ON P.TVA_ID = T.ID
      INNER JOIN SM_UNITATI_MASURA M ON P.UM = M.ID
      WHERE P.GRUPA_ID = :MY_PARAM
      ORDER BY P.NUME ASC
      INTO :ID, :NUME, :PROD_TVA_VAL, :BRUT, :TVA_PROCENT, :CALE_IMAGE, :SHOW_IMAGE, :TVA_ID, :COD_SGR, :U_MASURA
, :ID_DEP, :ID_TVA_AMEF
      DO
        SUSPEND;
    END
  END
  ELSE IF (:MY_PARAM IS NULL AND (:GESTIUNE_PARAM IS NULL OR :GESTIUNE_PARAM = 0)) THEN
  BEGIN
    -- Returneaz? toate articolele c?nd ambii parametri sunt NULL sau GESTIUNE_PARAM este 0
    FOR SELECT
      P.ID, P.NUME, P.PROD_TVA_VAL, P.BRUT, T.TVA_VAL AS TVA_PROCENT, P.CALE_IMAGE, P.SHOW_IMAGE, P.TVA_ID, P.COD_SGR, M.PRESCURTARE AS U_MASURA
, P.DEPARTAMENT, T.CASA_GRUPA
    FROM SM_PRODUSE P
    INNER JOIN SM_TVA T ON P.TVA_ID = T.ID
    INNER JOIN SM_UNITATI_MASURA M ON P.UM = M.ID
    ORDER BY P.NUME ASC
    INTO :ID, :NUME, :PROD_TVA_VAL, :BRUT, :TVA_PROCENT, :CALE_IMAGE, :SHOW_IMAGE, :TVA_ID, :COD_SGR, :U_MASURA
, :ID_DEP, :ID_TVA_AMEF
    DO
      SUSPEND;
  END
  ELSE
  BEGIN
    -- Filtrare doar pe GESTIUNE_ID c?nd MY_PARAM este NULL ?i GESTIUNE_PARAM nu este 0
    FOR SELECT
      P.ID, P.NUME, P.PROD_TVA_VAL, P.BRUT, T.TVA_VAL AS TVA_PROCENT, P.CALE_IMAGE, P.SHOW_IMAGE, P.TVA_ID, P.COD_SGR, M.PRESCURTARE AS U_MASURA
, P.DEPARTAMENT, T.CASA_GRUPA
    FROM SM_PRODUSE P
    INNER JOIN SM_TVA T ON P.TVA_ID = T.ID
    INNER JOIN SM_UNITATI_MASURA M ON P.UM = M.ID
    WHERE P.GESTIUNE_ID = :GESTIUNE_PARAM ORDER BY P.NUME ASC
    INTO :ID, :NUME, :PROD_TVA_VAL, :BRUT, :TVA_PROCENT, :CALE_IMAGE, :SHOW_IMAGE, :TVA_ID, :COD_SGR, :U_MASURA
, :ID_DEP, :ID_TVA_AMEF
    DO
      SUSPEND;
  END
END